<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <title>Admin - Đăng Nhập</title>

    <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="assets/css/sb-admin-2.min.css" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

    <style>
        html, body {
            height: 100%; /* Bắt buộc chiều cao full màn hình */
        }

        body {
            display: flex;              /* Biến body thành hộp chứa dẻo */
            align-items: center;        /* Căn giữa theo chiều dọc */
            justify-content: center;    /* Căn giữa theo chiều ngang */
        }

        .container {
            width: 100%;
            max-width: 1000px; /* Giới hạn chiều rộng để không bị bè ra quá to trên màn hình lớn */
        }
    </style>

</head>

<body class="bg-gradient-primary">

    <div class="container">

        <div class="row justify-content-center">

            <div class="col-xl-10 col-lg-12 col-md-9">

                <div class="card o-hidden border-0 shadow-lg">
                    <div class="card-body p-0">
                        <div class="row">
                            
                            <div class="col-lg-6 d-none d-lg-block bg-login-image"></div>
                            
                            <div class="col-lg-6">
                                <div class="p-5">
                                    <div class="text-center">
                                        <h1 class="h4 text-gray-900 mb-4">Quản Trị Hệ Thống</h1>
                                    </div>
                                    
                                    <form class="user" id="login-form" onsubmit="return false;">
                                        <div class="form-group">
                                            <input type="email" class="form-control form-control-user"
                                                id="inputEmail" 
                                                placeholder="Nhập Email..."
                                                value="admin@system.com" required>
                                        </div>
                                        <div class="form-group">
                                            <input type="password" class="form-control form-control-user"
                                                id="inputPassword" placeholder="Mật khẩu..."
                                                value="" required>
                                        </div>
                                        
                                        <button type="submit" id="btn-login" class="btn btn-primary btn-user btn-block">
                                            Đăng Nhập
                                        </button>
                                    </form>
                                    
                                    <hr>
                                    <div class="text-center">
                                        <a class="small" href="../user/index.html">← Quay về trang sự kiện</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

    </div>

    <script src="assets/vendor/jquery/jquery.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="assets/js/sb-admin-2.min.js"></script>
    
    <script src="../config.js"></script> 
    
    <script>
        function showToast(icon, message) {
            Swal.fire({
                toast: true, position: 'top-end', icon: icon, title: message,
                showConfirmButton: false, timer: 2500, timerProgressBar: true
            });
        }

        document.getElementById('login-form').addEventListener('submit', function(event) {
            event.preventDefault(); 
            handleAdminLogin();     
        });

        async function handleAdminLogin() {
            if (typeof API_BASE_URL === 'undefined') {
                Swal.fire('Lỗi Cấu Hình', 'Không tìm thấy file config.js.', 'error');
                return;
            }

            const email = document.getElementById('inputEmail').value.trim();
            const password = document.getElementById('inputPassword').value.trim();
            const btn = document.getElementById('btn-login');

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang xử lý...';

            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });

                if (response.ok) {
                    const data = await response.json();

                    if (data.role === 'Admin') {
                        localStorage.setItem("adminToken", data.token);
                        localStorage.setItem("adminUser", data.fullName); 

                        showToast('success', `Xin chào  ${data.fullName}!`); 

                        setTimeout(() => {
                            window.location.href = "dashboard.html"; 
                        }, 1000);
                    } else {
                        Swal.fire('Truy cập bị chặn', 'Tài khoản này không có quyền quản trị.', 'warning');
                        localStorage.removeItem("adminToken");
                    }
                } else {
                    Swal.fire('Thất bại', 'Email hoặc mật khẩu không đúng!', 'error');
                }
            } catch (error) {
                console.error(error);
                Swal.fire('Lỗi kết nối', 'Không thể gọi API.', 'error');
            } finally {
                btn.disabled = false;
                btn.innerText = 'Đăng Nhập';
            }
        }
    </script>

</body>
</html>